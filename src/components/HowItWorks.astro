---
// HowItWorks component - 3-step flow section
import FancyHeading from './FancyHeading.astro';
---

<section 
  class="how-it-works py-12 md:py-16 lg:py-20 relative overflow-hidden bg-white"
  aria-labelledby="how-it-works"
>
  <div class="container mx-auto px-6 md:px-12 lg:px-16 relative z-10">
    <!-- Section Header -->
    <div class="text-center mb-12 md:mb-16">
      <div data-reveal>
        <FancyHeading 
          as="h2"
          id="how-it-works"
          text="How it works"
          class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900"
        />
      </div>
    </div>

    <!-- Timeline Container with Background Panel -->
    <div class="how-it-works-timeline rounded-2xl p-8 md:p-12 lg:p-16" style="background-color: #050d36;">
      <!-- Steps List -->
      <ol class="how-it-works-steps grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12 relative">
        <!-- Step 1 -->
        <li class="how-it-works-step relative" data-reveal-index="0">
          <div class="step-content relative">
            <h3 class="text-xl md:text-2xl font-semibold mb-4 text-center relative z-10" style="font-family: 'Playfair Display', serif; font-style: italic; color: #5ECFFF;">
              Set it up once
            </h3>
            <!-- Vertical dotted line from label to image -->
            <svg class="step-connector-line absolute left-1/2 transform -translate-x-1/2 w-0.5 pointer-events-none z-0" style="top: 2.5rem; height: calc(100% - 2.5rem - 300px);" viewBox="0 0 2 200" preserveAspectRatio="none">
              <line 
                x1="1" 
                y1="0" 
                x2="1" 
                y2="100%" 
                stroke="#ffffff" 
                stroke-width="2" 
                stroke-dasharray="4,4" 
                opacity="0.6"
              >
                <animate
                  attributeName="stroke-dashoffset"
                  values="0;8"
                  dur="2s"
                  repeatCount="indefinite"
                />
              </line>
            </svg>
            <img 
              src="/set_up.png" 
              alt="Set it up once"
              class="how-it-works-image w-full h-auto object-contain min-h-[300px] md:min-h-[400px] relative z-10"
            />
          </div>
        </li>

        <!-- Step 2 -->
        <li class="how-it-works-step relative" data-reveal-index="1">
          <div class="step-content relative">
            <h3 class="text-xl md:text-2xl font-semibold mb-4 text-center relative z-10" style="font-family: 'Playfair Display', serif; font-style: italic; color: #5ECFFF;">
              Talk naturally
            </h3>
            <!-- Vertical dotted line from label to image -->
            <svg class="step-connector-line absolute left-1/2 transform -translate-x-1/2 w-0.5 pointer-events-none z-0" style="top: 2.5rem; height: calc(100% - 2.5rem - 300px);" viewBox="0 0 2 200" preserveAspectRatio="none">
              <line 
                x1="1" 
                y1="0" 
                x2="1" 
                y2="100%" 
                stroke="#ffffff" 
                stroke-width="2" 
                stroke-dasharray="4,4" 
                opacity="0.6"
              >
                <animate
                  attributeName="stroke-dashoffset"
                  values="0;8"
                  dur="2s"
                  repeatCount="indefinite"
                  begin="0.2s"
                />
              </line>
            </svg>
            <img 
              src="/talk.png" 
              alt="Talk naturally"
              class="how-it-works-image w-full h-auto object-contain min-h-[300px] md:min-h-[400px] relative z-10"
            />
          </div>
        </li>

        <!-- Step 3 -->
        <li class="how-it-works-step relative" data-reveal-index="2">
          <div class="step-content relative">
            <h3 class="text-xl md:text-2xl font-semibold mb-4 text-center relative z-10" style="font-family: 'Playfair Display', serif; font-style: italic; color: #5ECFFF;">
              Keep clear records
            </h3>
            <!-- Vertical dotted line from label to image -->
            <svg class="step-connector-line absolute left-1/2 transform -translate-x-1/2 w-0.5 pointer-events-none z-0" style="top: 2.5rem; height: calc(100% - 2.5rem - 300px);" viewBox="0 0 2 200" preserveAspectRatio="none">
              <line 
                x1="1" 
                y1="0" 
                x2="1" 
                y2="100%" 
                stroke="#ffffff" 
                stroke-width="2" 
                stroke-dasharray="4,4" 
                opacity="0.6"
              >
                <animate
                  attributeName="stroke-dashoffset"
                  values="0;8"
                  dur="2s"
                  repeatCount="indefinite"
                  begin="0.4s"
                />
              </line>
            </svg>
            <img 
              src="/record.png" 
              alt="Keep clear records"
              class="how-it-works-image w-full h-auto object-contain min-h-[300px] md:min-h-[400px] relative z-10"
            />
          </div>
        </li>
      </ol>

      <!-- Support Line -->
      <p 
        class="text-sm text-white text-center mt-8 md:mt-12"
        data-reveal
      >
        And if something goes offline, it tells you what changed.
      </p>
    </div>
  </div>
</section>

<style>
  @import '../styles/sections.css';
</style>

<script>
  import { initRevealOnScroll } from '../scripts/revealOnScroll';
  
  if (typeof window !== 'undefined') {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initRevealOnScroll);
    } else {
      initRevealOnScroll();
    }
  }
</script>
